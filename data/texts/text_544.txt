Location recommendation is deî€›ned as to recommend locations (POIs) to users in location-based services. The existing data-driving approaches of location recommendation suî€er from the limitation of the implicit modeling of the geographical factor, which may lead to sub-optimal recommendation results. In this work, we address this problem by introducing knowledge-driven solutions. Specifically, we î€›rst construct the Urban Knowledge Graph (UrbanKG) with geographical information and functional information of POIs. On the other side, there exist a fact that the geographical factor not only characterizes POIs but also aî€ects user-POI interactions. To address it, we propose a novel method named UKGC. We î€›rst conduct information propagation on two sub-graphs to learn the representations of POIs and users. We then fuse two parts of representations by counterfactual learning for the î€›nal prediction. Extensive experiments on two real-world datasets verify that our method can outperform the state-of-the-art methods. Location-based Social Networks (LBSNs) enable users to share their locations, check-ins, photos and comments via the Internet, which produces a large amount of data and facilitates the development of the Point-of-Interest recommendation. Besides the collaborative î€›ltering methods [12,34] that learn usersâ€™ preferences solely on the user-POI interaction data, various works leverage diî€erent kinds of side information to enhance the POI recommendation, such as geographical factors [30], social networks [39], categories [18], etc. Nevertheless, due to the lack of structural data, these works are still limited by the black-box properly of machine learning models, which leads to sub-optimal results. Overall speaking, the interactions between users and POIs are not entirely determined by the interests of users and the functional attributes of POIs. More precisely, a userâ€™s visit to a speciî€›c POI does not only mean that the POIâ€™s functional attributes are entirely matched to the requirements of users, but may indicate that the geographical distance between the user and the POI is relatively close. It can be regarded as a kind of geographical bias in the observed user-POI interaction data. Therefore, from the causal inference perspective [23], geographical factor not only characterizes POIs (the cause) but also aî€ects user-POI interactions (the eî€ect), and thus serves as a confounder. This will not only make it diî€œcult to accurately match usersâ€™ interests but drastically damage the performance of recommender systems. Geographical factors are important attributes of POIs intrinsically. Therefore, for a better learning of user interests, the recommendation model should ensure the geographical factor only aî€ects the attributes of POIs (indirect eî€ect) rather than directly aî€ects the interactions. To address the limitation of existing works and weaken the inî€uence of the bias caused by the geographical confounder, in this paper, we î€›rst build large-scale Urban Knowledge Graphs (UrbanKG) in two big cities, which provide rich knowledge on both geographical and functional aspects. After that, we divide the UrbanKG into two subgraphs, called geographical graph and functional graph according to the attributes of relations. We then design a graph neural network-based method that both learns from two subgraphs derived from UrbanKG and the user-POI interaction graph. Disentangled embeddings of POIs and users are learned for capturing their geographical and functional representations. Furthermore, we propose the causal graph based on which we further propose a counterfactual learning method for the î€›nal recommendation. The main contributions of this paper can be summarized as follows: â€¢To our best knowledge, we are the î€›rst to build large-scale UrbanKGs for POI recommendation. We also collect user-POI interactions that involve POIs overlapped with the UrbanKG. We hope that these datasets can beneî€›t the community. â€¢We propose the UKGC model that can learn from both the interaction graph and knowledge graphs well with disentangled embeddings. We also propose the counterfactual learning for recommendation, which can eliminate the geographical bias and model usersâ€™ interests accurately. â€¢We conduct extensive experiments to evaluate the performance and results show superior performances of our method. The results also demonstrate the eî€ectiveness and utility of our UrbanKG. Further experiments also validate the rationality of each component of our UKGC model. Notations and Problem Formulation.LetUbe the set of all users andPbe the set of all POIs. Deî€›ne the set of user-POI interactions asO= {(ğ‘¢, ğ‘)|ğ‘¢ âˆˆ U, ğ‘ âˆˆ P}, in which(ğ‘¢, ğ‘)means that the userğ‘¢has visited the POIğ‘in history. We formulate the problem to be addressed in this work as follows, â€¢ Input:the user-POI interaction datasetOand the urban knowledge graph G, which we will describe later. â€¢ Output:a function that can predict the probability of interaction between the user ğ‘¢ and the POI ğ‘, denoted asË†ğ‘¦. Earlier works about POI recommendations only used the historical interaction information to recommend similar POIs to users with similar proî€›les based on their preference, i.e., user-based collaborative î€›ltering or recommend POIs to users based on the similarity between POIs, i.e., content-based collaborative î€›ltering. However, due to the limited interaction data between users and POIs and unbalanced proportion of positive and negative samples, it will be diî€œcult to learn the representations of users and POIs well. In recent years, existing works about POI recommendations exploit the separated side information such as geographical locations (e.g. longitude and latitude) [24], categories [18], etc. However, Side information is predominantly in the form of bipartite graphs. Applying this information to the representation learning can improve the performance of POI recommendation to some extent, but does not structure the information well. The information is isolated from each other in diî€erent bipartite graphs, which makes it diî€œcult to propagate information between graphs. In this section, we î€›rst introduce the conceptional graph for our UrbanKG then the idea of knowledge disentanglement, which aims to disentangle geographical and functional attributes. As mentioned before, more integrated, structured and î€›ne-grained information needs to be obtained and applied to the recommendation tasks. In this paper, we take the pioneering stepto build a large-scale Urban Knowledge Graph (UrbanKG) that contains rich entities and relations to provide information of POIs more structured, naturally and comprehensively. Speciî€›cally, we î€›rst collect various POI information and citiesâ€™ geographical data from Tencent Map, a famous Map service in China. We then deî€›ne a conceptual graph that reconstruct these data into the urban knowledge graph. For the geographical attributes of POIs, we discard the confusing conventional features like longitude and latitude (speciî€›c locations), replacing them with entities like business areas and regions which exist in real cities and can be perceived by users. On the other hand, for the functional attributes of POIs, we collect three-level categories and brands, which serve as entities in UrbanKG and play important roles in î€›ne representations of POIs. The correlations between POI and these supplementary urban entities are depicted as diî€erent relations in UrbanKG. For example, LocateAt builds the correlation between a POI and a region, showing that the POI locates at the given region. BrandOf represents the correlation between a POI and a brand, indicating the brand of the given POI. There are 7 types of entities including POIs, business areas, regions, brands and categories, and 16 types of relations. We then collect the user check-in logs in WeChat, which is the largest instant messaging App in China. Through î€›ltering the overlapped POIs, we build datasets of two largest cities of China, Beijing and Shanghai for UrbanKG-enhanced POI recommendation. LetEbe the set of urban entities andRbe the set of relations. UrbanKG can be represented as a collection of tripletsG = {(â„, ğ‘Ÿ, ğ‘¡)|â„, ğ‘¡ âˆˆ E, ğ‘Ÿ âˆˆ R}, in which each triplet depicts the relation ğ‘Ÿexists between the head entityâ„and the tail entityğ‘¡. For instance, (Apple Store East Nanjing Road, BrandOf, Apple) indicates that the brand of POI Apple Store East Nanjing Road is Apple. To visualize the UrbanKG we build, we show an example of multiple entities and relations in our UrbanKG in Figure 1. By constructing UrbanKG, we integrate knowledge into a structured graph rather than multiple bipartite graphs, breaking the isolation of information in previous works. Meanwhile, the UrbanKG structure broadens the way of information propagation and Figure 1: An example of part of multiple entities and relations in our UrbanKG. For the given POI, UrbanKG provides its geographical attributes like business area and region it locates at, and functional attributes such as its brand and three-level categories. Table 1: Relations in the urban knowledge graph (â€œF" and â€œG" refer to â€œFunctional" and â€œGeographical", respectively. makes it accesible to exploit large-scale graph neural networks, which facilitates the representation learning. Diî€erent from traditional recommendation scenarios, such as ecommerce, where users can visit any item without eî€ort, POI recommendations should highly consider the userâ€™s cost of visitation. Speciî€›cally, users tend to check-in POIs around their range of activity, showing the strong impact of geographical constraint. From the perspective of causal inference, geographical factor not only characterizes POIs but also aî€ects the user-POI interaction, playing as a confounder. Nevertheless, such confounder eî€ect has not been explored by existing works. Fortunately, our built UrbanKG provides a precious opportunity to consider it. Speciî€›cally, UrbanKG mainly intergrates two kinds of POI information, geographical and functional. Therefore, the relations are classiî€›ed to two types, geographical type and funtional type based on the information they provide, as shown in Table 1. For example, BelongTo is a geographical relation and it denotes the business area where a POI is aî€œliated. BrandOf and Cate1Of are functional relations and they depict the brand and the coarse-level category of POIs, respectively. The geographical-type relation is abbreviated asğº, and the functional-type relation is abbreviated asğ¹in Table 1. Furthermore, we divide our constructed UrbanKG into two subgraphs, called the geographical graph and the functional graph, according to the type of relations. Geographical graph contains the relations of the geographical type and geographical entities like business areas and regions. Correspondingly, functional graph contains the relations of the functional type and functional entities such as brands, coarse-level, mid-level and î€›nelevel categories of POIs. It should be noted that the same POIs are contained both in the geographical graph and the functional graph. In the following, we will introduce our UKGC model learning from both user-POI interaction data and the UrbanKG for recommendation. To tackle the geographical bias of check-in behaviors and get a better POI recommendation performance, we propose an eî€ective model called UKGC, which is illustrated in Figure 2. It consists of three parts: â€¢ Disentangled Embedding Layer:We propose to utilize two sets of embeddings for geographical and functional attributes of POIs and user interests, to make these two aspect of attributes disentangled. â€¢ Graph Convolutional Layer:In order to learn disentangled representations of geographical and functional attributes, we train two sets of embeddings with geographical graph and functional graph derived from UrbanKG and user-POI interaction graph by information propagation via graph convolutional network. â€¢ Counterfactual Learning:Finally, we present the causal graph where geographical attributes directly aî€ect on the probability of interaction and introduce counterfactual inference to alleviate the geographical bias and for more accurate POI recommendations. To learn î€›ne-grained embeddings represented both in geographical and functional aspects, we assign two chunks of embeddings for users and POIs, corresponding to the knowledge disentanglement in Section 2. The geographical and functional embeddings can be denoted by ğ‘” and ğ‘“ in the subscript, respectively. We deî€›ne the geographical embedding and the functional embedding of userğ‘¢(POIğ‘) asu, uâˆˆ R(p, pâˆˆ R), whereğ‘‘ denotes the embedding size. And we describe the non-POI entity ğ‘£in the geographical graph with an embedding vectorvâˆˆ R, andğ‘£in the functional graph withvâˆˆ R. Then the parameter embedding matrix of the geographical graph and the functional graph can be denoted as: E= [u; Â· Â· Â· ; u; p; Â· Â· Â· ; p; v; Â· Â· Â· ; v],(1) E= [u; Â· Â· Â· ; u; p; Â· Â· Â· ; p; v; Â· Â· Â· ; v]. whereğ‘andğ‘€refer to the number of users and POIs, respectively. ğ‘Šandğ‘„refer to the number of non-POI entities in the geographical graph and the functional graph. To connect the user-POI interaction graph with the knowledge graph, Wang et al [35] proposed that the user-POI interactions are driven by several intents, which can be represented by the distribution of relations in KG. Inspired by it, here we model usersâ€™ two sets of intentions, geographical and functional intents simultaneously, denoted as Iand I. The embedding of theğ‘–-th intent in the geographical graph is deî€›ned as follows, whereRrepresents the set of relations in the geographical graph, andris the embedding of theğ‘—-th relation in the geographical graph.ğ›¼ (ğ‘–, ğ‘—)denotes the attention score, which can be formulated as follows, whereğ‘ is the trainable weight for theğ‘—-th relation and theğ‘–-th intent, which is applicable to all users. The embedding of theğ‘–-th intent in the functional graph, i.e. e, is derived similarly. Following the previous work [28,29], we utilize the distance correlation as the regularizer to make sure user intents are independent to carry as much information as possible. As follows, whereğ‘‘ğ¶ğ‘œğ‘Ÿ (Â·)represents the distance correlation between two intents, formulated as follows, whereğ‘‘ğ¶ğ‘œğ‘£ (Â·)indicates the distance covariance of two embeddings, and ğ‘‘ğ‘‰ ğ‘ğ‘Ÿ (Â·) indicates the distance variance of each embedding. User embeddings should contain information from both KG and user-POI interaction. Therefore, we propose the embedding propagation layer as follows, wherepandurepresent the embedding of theğ‘˜-th POI and theğ‘–-th user respectively in the geographical graph, deî€›ned in Equation 1.âŠ™is the Hadamard product.N= {ğ‘|(ğ‘¢, ğ‘) âˆˆ O} represents the positive POI sample related to userğ‘¢, andğ›½ (ğ‘–, ğ‘—)is the attention score of intent ğ‘’about user ğ‘¢, formulated as: whereuis the embedding of theğ‘–-th user in the geographical graph, deî€›ned in Equation 1.eis the embedding of theğ‘—-th intent of the geographical graph. For the embeddings of POIs in the geographical graph, we derive them by similar propagation rules. The diî€erence is that the embeddings of POIs are obtained through the information propagation on a partitioned urban knowledge graph, based on various relations. POIs have no preference for information from a certain relation, so we do not need to assign the attention score for POI ğ‘and relationğ‘Ÿ. Similarly, the embeddings of non-POI entities V= [v;Â· Â· Â·;v]in the geographical graph can also be acquired analogously, propagating according to the same manner. Figure 2: The framework of our proposed model UKGC. UKGC contains three parts: Disentangled Embedding Layer, Graph Convolutional Layer and Counterfactual Learning. After captured the î€›rst-order connectivity of nodes in the graph,îƒîƒ we extend more layers to better acquire information from highorder neighbors. Propagated forğ‘™layers, we can obtain embeddingsîŒ recursively:YîŒY Inspired by the information combination method proposed by the previous work [38], we integrate two sets of embeddings fromî¬µî¬¶î¬»î¬¼ two partitioned knowledge graphs via the linear combination and get î€›nal embeddings of theğ‘–-th user and theğ‘–-th POI, formulated as follows, As mentioned in Section 1, the geographical factor can be consid-G ered as the confounder from the causal inference view [23]. To address it, here we î€›rst present the causal graph of the recommen-PY dation task and then propose a counterfactual learning method. 3.3.1 Causal Graph in POI Recommendation. The causal graph is in the form of directed acyclic graphG = {N, E}, whereNdenotesFUG the variables andEdenotes the causal relations. The capital letters in the causal graph are random variables, and the lowercase letters are corresponding values of them. The directed edge indicates thatPY the head node has a causal eî€ect to the tail node. As shown in theY Figure 3(a), P represents POIs, G and F represents the geographical and functional attributes of the POI, respectively. U representsFU users, and Y means the probability of the user-POI interaction. In the conventional POI recommendation models, POIs contain geographical and functional attributes, reî€ected in the causal graph Figure 3: The causal graphs for the factual world, the counterfactual world and the reference status, where * denotes the reference value of random variables, (a) denotes the proposed causal graph, (b) denotes the factual world, (c) denotes î¬µî¬µthe counterfactual world, (d) denotes the reference status. attributes, i.e., geographical bias. According to the causal graph, the value of Y and P can be derived as where Y(Â·)and P(Â·)denotes the function to get the value of Y and 3.3.2 Counterfactual Learning. For theğ‘–-th userğ‘¢, the total eî€ect (TE) of theğ‘—-th POIâ€™s attributes G= ğ‘”and F= ğ‘“on the likelihood of interaction can be formulated as follows, whereğ‘=P(G= ğ‘”,F= ğ‘“)andğ‘”are the reference value of G and P, respectively. Reference value means that the POI does not Improving Location Recommendation have its own characteristics, and the corresponding attributes (G or P) of POIs are all the same, taking the average value. The geographical bias can be expressed as the natural direct eî€ect (NDE) of geographical attributes on the probability of interaction, which can be formulated as follows, whereğ‘,ğ‘”andğ‘“are the reference value of P, G and F, respectively. Yrefers to the counterfactual world, representing what the interaction probability would be if a user can only obtain the geographical information of the POI. To eliminate the geographical bias, we need to subtract theNDE of G fromTE. The implication is that users will not interact based on geographical information alone, but make decisions taking a combination of geographical and functional information of the POI into consideration. Because there is no direct eî€ect path Fâ†’Y, we do not need to subtract theNDEof F and then get the total indirect eî€ect (TIE) of geographical attributes G and functional attributes F after subtracting theNDEof G. Now, we use theTIEas the debiased interaction prediction score between userğ‘¢and POIğ‘, formulated as follows, We split Yand Yinto three kinds of scores, Y, Yand Y, whereğ‘”represents the geographic attributes of POIğ‘. Inspired by previous work [4,22,32], we calculate the values of these two components adopting the fusion strategy, formulated as follows, whereğ‘“ (Â·)represents the fusion function. One promising choice is as follows, Each components stated before can be calculated by the inner product of embeddings, which refer to the ultimate embeddings after propagation in (12), formulated as follows, wherePdenotes the set of POIs and|ğ‘ƒ |is the cardinality of the set |ğ‘ƒ |. To optimize the prediction of Yin the factual world, we utilize the BPR loss [26] to distinguish between positive and negative samples as follows,îƒ• whereO = {(ğ‘¢, ğ‘, ğ‘)| (ğ‘¢, ğ‘) âˆˆ O, (ğ‘¢, ğ‘) âˆˆ O}denotes the training set,Orepresents positive interactions, i.e. observed check-in data between users and POIs, andOrepresents negative interactions, i.e. unobserved. ğœ(Â·) denotes the sigmoid function. We also need to better learn the prediction of Yin the counterfactual world. Note that for userğ‘¢, Y= E(Y)is identical for every POI. Hence, we only need to use the BPR loss to distinguish Yand Yas follows, where the deî€›nition ofOis similar to (21), andğ‘”andğ‘”are geographical attributes of ğ‘and ğ‘, respectively. By combiningL,L, and independent lossLin (4), the full objective function can be formulated as follows, whereğœ†andğœ†represents the hyperparameters controlling the independence loss andğ¿regularization term, respectively.Î˜denotes trainable parameters in the entire model. Trainable parameters in the geographical graphÎ˜are also there to prevent the overî€›tting of Y.ğ›¼is the hyperparameter controlling the relative weight of learning in the factual world compared with the counterfactual world. In this section, we conduct experiments to show the eî€ectiveness of the proposed UKGC model and we aim to answer the following research questions: â€¢ RQ1:How does our proposed UKGC model perform compared with diî€erent kinds of state-of-the-art recommendation methods? â€¢ RQ2:How do diî€erent components in the proposed UKGC aî€ect the model? â€¢ RQ3:What are the inî€uences of diî€erent settings of hyperparameters in our model? â€¢ RQ4:Can the proposed UKGC model really capture geographical attributes and functional attributes of POIs well? Datasets.We construct UrbanKG datasets on the two most biggest cities in China, Beijing and Shanghai. We have also collect usersâ€™ check-in data of which the POIs exists in the UrbanKG. The statistics are shown in Table 4.Baselines.Although our work targets POI recommendation, it is not appliable to compare our model UKGC with other conventional GNN-based POI recommendation models. Because of our pineering step to build the UrbanKG, our datasets no longer contain the speciî€›c location information such as the longitude and latitude of POIs, which are widely used in existing POI recommendation models and collected in most user-POI interaction datasets. Besides, conventional GNN-based POI recommendation models [6,17] cannot make use of other information such as brands and categories provided in the UrbanKG, and then it may lead to unfairness to some extent. After considering the reasons above, we compared our model with three kinds of SOTA recommendation methods in conventional tasks, including feature-based methods (FM, DeepFM, and AutoInt), collaborative î€›ltering (LightGCN), and KG-based methods (CFKG, CKE, KGAT, and KGIN).Evaluation Metrics.As for top-ğ¾recommendation performance, we adopt a Table 3: AUC performance comparison in two datasets. full ranking strategy to test the performance. We consider the interacted POIs to be the positive samples for every user and treat other POIs as negative. We use two widely-accepted ranking metrics, Recall@ğ¾and NDCG@ğ¾. However, the full-ranking task for traditional feature-based methods is not acceptable due to the extremely high computation cost. Following the original papers [10,27], we use the AUC metric to evaluate these models with sampled negative items. Hyper-Parameter Settings.We implement our UKGC model in PyTorch. We î€›x embedding size as 64, which is commonly accepted in existing works [1,33,35]. Since we have deployed two parts of disentangled embeddings, for each part we assign the size as 32 for fair comparison. We use the Adam optimizer, set the batch size as 1024 and use Xavier initilizations for model parameters. We adopt a careful grid search of learning rate in{10,10,10} and the coeî€œcient ofğ¿normalization in{10,10, Â· Â· Â· ,10}. For CFKG, CKE, KGAT and KGIN, we tune the message dropout ratio and node dropout radio in{0.0,0.1, Â· Â· Â· ,0.8}. For the multi- Moreover, early stopping is used, where we stop training if the validation performance does not increase for ten successive epochs. We show the performance of all models in Table 2. It should be noted that these experimental results are averages obtained after multiple times of experiments with diî€erent random seeds. From the experimental data, we can obtain the following results. â€¢ Our proposed UKGC method steadily achieves the best performance.Our model improves over the best baseline w.r.t. AUC by 3.80%, Recall by 13.51%âˆ’23.16%, and NDCG by 22.22%âˆ’30.33% in Beijing dataset, and improves over w.r.t. AUC by 3.85%, Recall by 5.16%âˆ’7.74%, and NDCG by 8.75%âˆ’11.51% in Shanghai dataset. Our UKGC method achieves signiî€›cant improvements on all metrics. â€¢ Necessity and eî€ectiveness of building UrbanKG.Compared with feature-based methods, our model signiî€›cantly improves w.r.t. AUC by 7.65% in Beijing dataset, 5.98% in Shanghai dataset. It indicates the necessity and eî€ectiveness of building and utilizing structural knowledge rather than separated features for the POI recommendation. We can also observe KGIN which is the SOTA KG-based recommendation model, serves as the best baseline, with the second best performance on Shanghai, only under our UKGC, and competitive performance on Beijing. It further demonstrates that our built UrbanKG can help improve the recommendation performance. â€¢ It is essential to leverage UrbanKG appropriately.We can observe that KG-based methods, CKE, CFKG and KGAT, get poorer performance than feature-based methods w.r.t. AUC in Shanghai dataset, which reveals that they cannot exploit urban knowledge appropriately. They also get poorer performance than LightGCN w.r.t. Top-K metrics. Besides, KGIN either cannot beat LightGCN on Top-K metrics for the Beijing dataset. These observations reveal that special designs are required to leverage UrbanKG well. In our method, we design disentangled embeddings along with corresponding GCN layers and counterfactual learning, fully modeling geographical and functional attributes, thus achieves the best performance. We perform ablation experiments to measure each designed components. In our UKGC method, we î€›rst deploy separated information propagation layers on the disentangled embeddings and then adopt counterfactual inference for prediction. To study the eî€ectiveness of these two parts of designs, we remove one of them and test the performance. To remove the design of disentangled embeddings, we learn two sets of embeddings with two complete urban knowledge graphs without dividing. Precisely speaking, we give each set of embeddings blended knowledge to learn the representations and rating with counterfactual learning, to see whether it can capture Figure 4: Ablation study on Beijing dataset. Figure 5: Ablation study on Shanghai dataset. geographical and functional attributes under this situation. To remove the design of counterfactual inference, diî€erent from (16), we just use TE = Yâˆ’ Yas predictedË†ğ‘¦. The experimental results of Beijing and Shanghai datasets are reported in Figure 4 and 5, respectively. â€¢Without the design of disentangled embedding, the performance are much worse than original proposed model on both two datasets. Speciî€›cally, the relative decrease is 11.3%âˆ’17.3% in Recall and 17.7%âˆ’22.6% in NDCG in Beijing dataset, 6.4%âˆ’12.1% in Recall and 13.7%âˆ’16.6% in NDCG in Shanghai dataset. It indicates the importance of knowledge disentanglement, which is essential for the better usage of the urban knowledge graph. â€¢Without counterfactual inference rating, the performance on all metrics also has a certain degree of decrease in both dataset. Speciî€›cally, the relative decrease is 1.0%âˆ’2.0% in Recall and 1.0%âˆ’1.5% in NDCG in Beiijing dataset, 1.1%âˆ’1.9% in Recall and 1.7%âˆ’2.3% in NDCG in Shanghai dataset. It demonstrates the importance of counterfactual inference to alleviate geographical bias. In this section, we explore the eî€ect of diî€erent hyper-parameters on model performance. We conduct extensive studies of 1) the number of propagation layersğ‘™in (8) and (9), 2) the relative weightğ›¼ in (23), 3) the number of user intents|I|in (2), and 4) fusion strategy in (18).Eî€ect of ğ›¼.Hyper-parameterğ›¼represents the relative weight of learning in the factual world and the counterfactual world. Since diî€erent datasets have diî€erent geographical bias,ğ›¼needs to be tuned. The results of diî€erentğ›¼values are shown in Figure 6. We can observe that settingğ›¼ =0 makes performance worse, reî€ecting that we cannot abandon learning in the counterfactual world. Asğ›¼ Figure 6: Performance of diî€erent ğ›¼ in Beijing dataset. Figure 7: Performance of diî€erent propagation layers. Figure 8: Performance of diî€erent user intents. rises, the performance of the model also rises gradually, illustrating the importance of learning in the counterfactual world. The experimental results show thatğ›¼ =1 is appropriate on Beijing dataset, whileğ›¼ =3 seems better to Shanghai dataset. Further makingğ›¼ continue to increase does not result in a signiî€›cant improvement for model performance. Eî€ect of propagation layers.We also test the eî€ect of diî€erent numbers of propagation layers, also called hops. Following existing works [33,35], we search hops in{1,2,3,4}to î€›nd the most proper number of layers. The results are reported in Figure 7. We î€›nd that our model can reach the best performance with three propagation layers. Fewer propagation layers can only obtain information from low-order connectivity, i.e. their nearest neighbors, which limits learning better representations. On the other hand, stacking too many propagation layers could make all nodes aggregate information from almost all other nodes in the graph, which may make the representations of some nodes indistinguishable and over-î€›tting. Hence, we recommend three propagation layers in our model. Eî€ect of the number of user intents.We also analyze the inî€uence of the number of user intents in each partitioned graph. Figure 9: The cosine similarity of two parts of embeddings. We search the number of intents|I|in{1,2,4,8}and present the results inFigure 8. We î€›nd that the number of user intents needs to be adjust for diî€erent datasets due to the heterogeneity of the data. For example, we can obtain the best performance on Beijing dataset by setting|I| =3, however|I| =1 seems to be a better choice for Shanghai dataset. Too much independent intents may be diî€œcult to carry useful information, which could explain the decrease of performance when the number of intents becomes large. To further investigate POIsâ€™ embedding learning of geographical and functional aspects and verify the eî€ect of disentangling, we choose two regions in each city with enough number of POIs and interactions, then observe the similarity of geographical and functional embeddings of POIs located in the same region. CY Park and Wudaokou are chosen in Beijing, which are two famous regions with diverse POIs. We select Nanjing Road and Global Harbor in Shanghai for the same reason. We then calculate the cosine similarity of every two POIsâ€™ disentangled embeddings and use their average values as the cosine similarity of the geographical or functional embeddings of POIs in the region. The results are presented in the form of a bar chart in Figure 9. From the î€›gure, we can know that the geographical embeddings of POIs are signiî€›cantly more similar compared with their functional embeddings within the selected regions, which is in line with our expectations. Speciî€›cally, POIs in the same region have similar geographical attributes while their functional attributes should be diî€erent. Experimental results validate our model can capture geographical and functional aspects well, thus demonstrating that we do learn the representation of POIs more accurately. Point-of-Interest Recommendation.In recent years, various methods have been proposed to improve the performance of POI recommendation tasks [6,7,15,17]. In addition to the interaction data between users and POIs, side information has been widely used. For example, RankGeoFm [14] generates two embeddings for each user, representing usersâ€™ preference and nearby POIs respectively. MTEPR [8] leverages social relations and proî€›les of users, categories and locations of POIs for recommendation tasks, integrating them into multiple bipartite graphs. IRenMF [20] exploits the similarity between POIs according to the geographical distance. In our work, we construct the UrbanKG containing a wide variety of side information, which is more comprehensive and strutured than the previous models. We think it can facilitate the learning of representations of users and POIs. Knowledge Graph-based Recommendation.Before we introduce the urban knowledge graph into the î€›eld of POI recommendation, the knowledge graph has been used in other recommendation tasks [2,5,40]. For example, CKE [40] exploits TransE to obtain embeddings of entities in the KG, feeding them into matrix factorization. CFKG [1] regards interaction between users and POIs as a kind of relation in the KG and learns to predict whether this relation exists. Other methods [11,31,34,36] utilize information aggregation mechanism of graph neural networks to propagate information on the KG. For example, KGAT [33] propagates on the composite graph intergrating KG and interactions, adopting attention mechanism. In addition to information propagation on the KG, KGIN [35] models the intent layer between users and POIs. To our best knowledge, our work is the î€›rst attempt to introduce the urban knowledge graph to the POI recommendation task. Causal Recommendation.Causal recommendation is often used to debias in recommendation tasks [9,13,41]. For example, IPW [16] estimate the propensity of popular, and re-weight samples using the inverse propensity scores. MACR [37] conducts a multi-task learning with counterfactual inference for eliminating the popularity bias. Wang et al (2021a) use counterfactual inference to eliminate exposure bias. Based on IPS, McInerney et al (2020) proposes Reward Interaction IPS to eliminate the bias by logged data when evaluating oî€Ÿine. In our work, we introduce counterfactual inference to remove the geographical bias in interactions and achieve better performance. In this work, we address the POI recommendation from a brand new perspective, taking a pioneering step to introduce the urban knowledge graph and combine the counterfactual inference to this problem. We î€›rst build the urban knowledge graph that contains structural information of POIs, which can be disentangled into the functional aspect and the geographical aspect. Since the geographical factor plays as a confounder, we propose a graph neural network-based model, UKGC, with counterfactual learning. Extensive experiments verify the eî€ectiveness of the constructed UrbanKG and the proposed UKGC method. As for the future work, we plan to conduct online A/B tests in real-world recommender systems, to further evaluate the eî€ectiveness of the UrbanKG and the UKGC model.