In collaborative î€›ltering, it is an important way to make full use of social information to improve the recommendation quality, which has been proved to be eî€ective because user behavior will be affected by her friends. However, existing works leverage the social relationship to aggregate user features from friendsâ€™ historical behavior sequences in a user-level indirect paradigm. A signiî€›cant defect of the indirect paradigm is that it ignores the temporal relationships between behavior events across users. In this paper, we propose a novel time-aware sequential recommendation framework called Social Temporal Excitation Networks (STEN), which introduces temporal point processes to model the î€›ne-grained impact of friendsâ€™ behaviors on the userâ€™s dynamic interests in an event-level direct paradigm. Moreover, we propose to decompose the temporal eî€ect in sequential recommendation into social mutual temporal eî€ect and ego temporal eî€ect. Speciî€›cally, we employ a social heterogeneous graph embedding layer to reî€›ne user representation via structural information. To enhance temporal information propagation, STEN directly extracts the î€›ne-grained temporal mutual inî€uence of friendsâ€™ behaviors through the mutually exciting temporal network. Besides, userâ€™s dynamic interests are captured through the self-exciting temporal network. Extensive experiments on three real-world datasets show that STEN outperforms state-of-the-art baseline methods. Moreover, STEN provides event-level recommendation explainability, which is also illustrated experimentally. â€¢ Information systems â†’ Recommender systems;â€¢ Computing methodologies â†’ Neural networks. Temporal Point Process; Sequential Recommendation; Attention Mechanism; Social Recommendation ACM Reference Format: Yunzhe Li, Yue Ding, Bo Chen, Xin Xinand Yule Wang, Yuxiang Shi,Ruiming Tang, Dong Wang. 2021. Extracting Attentive Social Temporal Excitation for Sequential Recommendation. In Proceedings of the 30th ACM International Conference on Information and Knowledge Management (CIKMâ€™21), November 1â€“5, 2021, Virtual Event, QLD, Australia. ACM, New York, NY, USA, 10 pages. https://doi.org/10.1145/3459637.3482257 In recent years, sequential recommendation, as an emerging topic for capturing user dynamic interests from user behaviors, has received extensive attention from the industry and academia. Various methods emerge to utilize deep sequential models, such as Recurrent Neural Networks (RNNs) [9], Convolution Neural Networks (CNNs) [32], Attention mechanisms [11,14] to extract features from the successive behavior event sequence and enhance recommendation performance. Moreover, some works [1,15] model the time interval to capture usersâ€™ demands over time. Nevertheless, for an enormous set of items, only a tiny fraction is involved in a single user behavior sequence. This phenomenon limits the performance of sequential recommendation. Furthermore, based on the social inî€uence and social homophily [19,20,27], social relationship plays an important role in recommending suitable items for users. Some works leverage the social relations to aggregate similar usersâ€™ preferences to enhance collaborative î€›ltering and matrix factorization or integrate deep neural networks into probabilistic matrix factorization for rating prediction [5,18,31,34,43]. Moreover, Graph Neural Networks (GNNs) are also utilized to enhance the performance of recommendation for better capturing the structural information of social relations [6,22,38,39]. However, these approaches are coarse-grained that only model user-level relationships and ignore the inî€uence of the user behavior sequence. To leverage social inî€uence to enhance sequential recommendation performance, existing methods [28,30] usually model both social relations and userâ€™s behavior sequences in an indirect manner. As Figure 1 shows, the indire ct paradigm of the methods (the green path) usually can be summarized in three steps: (1) learning friendsâ€™ representation from their behavior sequences; (2) learning the target userâ€™s representation from her own behavior sequence; (3) aggregating the inî€uence of friends on the target user through their representations. However, the indirect paradigm usually suffers from information loss due to the ignorance of the relationships between behavior events across users. Compared with the indirect paradigm, modeling the inî€uence of diî€erent user behavior sequences in the direct paradigm (the orange path) is more granular to avoid the problem mentioned above and better model the interaction between cross-user events. Nonetheless, to the best of our knowledge, existing works do not contemplate such a direct modeling paradigm, leaving vast scope Figure 1: An illustration of two paradigms to deal with asynchronous behavior event sequences and social relations in online communities. for exploration. Besides, unlike the synchronous sequence taken at consecutive equal intervals, the usersâ€™ behavior sequences tend to be asynchronous when considering interactions across user events. Diî€erent from only taking the order of events into consideration, how to leverage the temporal information is another challenge for properly modeling the asynchronous sequences. We use a simple example shown in Figure 1 to illustrate this issue. If Alice buys heels within a short time after her friend Bob buys dress shoes, i.e., ğ‘¡â‰¤ ğ‘¡, then it indicates that Bobâ€™s behavior is more likely to aî€ect her (e.g., attending certain common activities). But ifğ‘¡â‰ª ğ‘¡or ğ‘¡> ğ‘¡, Bobâ€™s behavior will have less or no eî€ect on Alice. If the temporal information is lost, the model will not be able to determine the speciî€›c relationship between the two events. Hence, the time interval should be treated as important as the order, especially when we note the interaction of cross-user events. To address the problems mentioned above, we propose a novel approach calledSocialTemporalExcitationNetworks (STEN), which models individual userâ€™s sequence and the interaction between users together. STEN is designed to learn the inî€uence of temporal information by modeling the temporal eî€ect, which is decomposed into social mutual temporal eî€ect and ego temporal eî€ect. Speciî€›cally, the former aggregates the impact of friendsâ€™ behavior sequences over time, and the latter describes the changes in interests reî€ected by the userâ€™s own behavior sequence. Our model introduces the temporal point process, which is a powerful tool for asynchronous sequence modeling, to model the eî€ect of related cross-user events with temporal information in a î€›ne-grained manner. Speciî€›cally, node representation of both users and items are extracted from the social relationship structure and interactions by a social heterogeneous graph embedding layer. To explore the impact of cross-user events in a direct paradigm, we model the interaction of friendsâ€™ behavior event sequences as mutually exciting processes and enhance it by attention mechanism to better describe the social mutual temporal eî€ect in the mutually exciting temporal network. Finally, a self-exciting temporal network is employed to model the target userâ€™s ego temporal eî€ect and generate the userâ€™s temporal representation. To summarize, we make the following contributions in this paper: â€¢We propose to take temporal information and social relationships into account in the sequential recommendation, i.e., model the impact of friendsâ€™ behavior event sequences at the event level. To the best of our knowledge, it is the î€›rst attempt to enhance sequential recommendation performance with event-level social information in a direct paradigm. â€¢We propose a novel time-aware sequential recommendation model STEN. Two temporal excitation networks are designed for modeling both the event-level dynamic inî€uence of social relationship and userâ€™s dynamic interests. In particular, STEN can model the î€›ne-grained associations of cross-user events. â€¢We conduct extensive experiments on three real-world datasets and the results demonstrate that STEN outperforms state-of-theart recommendation models and the eî€ectiveness of the modules in STEN. Besides, we illustrate the advantage of the event-level explainability of our model. In this section, we î€›rst introduce the temporal point process as background and then give the problem formulation. A temporal point process is a stochastic process consisting of a series of events in the continuous-time domain. Letğ»= {ğ‘¡|ğ‘¡< ğ‘¡} be the set of historical events that happened before timeğ‘¡, where {ğ‘¡, ğ‘¡, ..., ğ‘¡}is the time sequence of past events. To characterize the Point ProcessP(ğœ†(ğ‘¡ |ğ»))for arbitrary timeğ‘¡in a certain time interval[0,ğ‘‡ ], a conditional intensity functionğœ†(ğ‘¡|ğ»)is imported to represent the intensity function of the event occurring at timeğ‘¡ under the condition of the subset of history eventsğ»up to timeğ‘¡. Based on the conditional intensity function and the past events in {ğ‘¡, ğ‘¡, ..., ğ‘¡}, the probability density function of the next event at time ğ‘¡is obtained as follows. ğ‘ (ğ‘¡|ğ‘¡, ğ‘¡, ..., ğ‘¡) = ğœ†(ğ‘¡|ğ»)ğ‘’ğ‘¥ğ‘âˆ’ğœ†(ğ‘¡|ğ»)ğ‘‘ğ‘¡. (1) The probability density function of a whole observed event sequence occurred at{ğ‘¡, ğ‘¡, ..., ğ‘¡}in interval[0,ğ‘‡ ]could be represented by: ğ‘ ({ğ‘¡, ğ‘¡, ..., ğ‘¡}) =ğœ†(ğ‘¡|ğ»)ğ‘’ğ‘¥ğ‘âˆ’ğœ†(ğ‘¡|ğ»)ğ‘‘ğ‘¡. (2) The log-likelihood function ğ“ of the observing event sequence is: ğ“ (ğ‘ ({ğ‘¡, ğ‘¡, ..., ğ‘¡})) =ğ‘™ğ‘œğ‘”(ğœ†(ğ‘¡|ğ»)) âˆ’ğœ†(ğ‘¡ |ğ»)ğ‘‘ğ‘¡. (3) Denote as Eq. (3), the conditional intensity function plays an essential role in mapping the history event sequence to the probability density function. Take the Hawkes Process [8] as an example, the conditional intensity function of this popular point process is denoted as Eq. (4):îƒ• whereğœ‘ (Â·)is a non-negative function. Eq. (4) shows that the historical events have an incentive eî€ect on the occurrence of future events and the inî€uence of historical events is superimposed in Figure 2: The architecture of STEN. Firstly, through the social graph embedding layer, the node representation of users and items is generated by leveraging the sequence of events and social relations. Then, the embeddings of events are sent to the mutually exciting attention networks to obtain the social mutual temporal representations. Next, mutual temporal representations are fused in self-exciting temporal networks to capture the temporal dynamic representation â„ attention is adopted to get the general interests â„. After that, â„ adopts joint learning for both î€›tting the temporal point process and recommendation. the form of accumulation. Based on whether there are interactions between multiple processes, the Hawkes Process could be divided into mutually exciting and self-exciting processes. The time-aware sequential recommendation with social information takes both user behavior sequences and their social relations into consideration. Letğ‘ˆ,ğ¼denote the set of users and items respectively and|ğ‘ˆ |, |ğ¼ |represent the total number of users and items. For each userğ‘¢ âˆˆ ğ‘ˆ, her behavior sequence is described ass= {ğ‘–, ğ‘–, ..., ğ‘–}, whereğ‘™is the length of sequence andğ‘–âˆˆ ğ¼ denotes the item that userğ‘¢has interacted at timeğ‘¡. The set of all usersâ€™ behavior sequences is deî€›ned asğ‘† = {s, s, ..., s}. For a subset of usersğ¹ âŠ‚ ğ‘ˆ, the set of their behavior sequences is denoted asS. In addition, userâ€™s social relationship could be deî€›ned as a social networkğº = (ğ‘‰ , ğ¸), whereğ‘‰denotes the node set of users andğ¸is the edge set that represents social links between users. Formally, given usersâ€™ social relations networkğºand their behavior sequencesğ‘†, our task is to make a prediction and recommend the next item that the user may be interested in. As mentioned above, to take the inî€uence of both behavior sequences and social relations into consideration, we design a novel time-aware sequential recommendation model STEN, which introduces temporal point processes to directly model the î€›ne-grained impact of friendsâ€™ behaviors at the event level. The architecture of our model STEN is shown in Figure 2. Specifically, we leverage social relations and user behavior sequences to generate the social node embedding for both users and items through the social graph embedding layer. To capture the ordinary , â„are fused to make recommendation. In addition, here social demands, vanilla attention is adopted to get the general interests of the target user. To directly model the impact of friendsâ€™ behavior sequences, the embeddings of their interacted sequences are sent to the mutually exciting temporal network as mutually exciting processes to generate the social mutual temporal representations. To establish the connection within the sequences, these social mutual temporal representations are fused in the self-exciting temporal network to capture the target userâ€™s dynamic interests. After that, we fuse the general interests and the dynamic interests to make recommendations. To guarantee eî€ective learning from the temporal point process, we adopt joint learning in the training stage for both î€›tting the temporal point process and recommendation. 3.1.1 Social Heterogeneous Graph Embedding. The social graph embedding aims to extract the general information from the social relations and interactions. In our model, we leverage a heterogeneous graph to represent the relationships for better scalability. For a social heterogeneous networkğº= (ğ‘‰, ğ¸),Vdenotes the nodes of both items and users,ğ¸denotes the edge set which involves two types of edges: (1) user-user social links; (2) user-item interaction connection. We î€›rst generate the embedding matrices ğ‘ˆ âˆˆ R,ğ¼ âˆˆ Rvia embedding lookup, whereğ‘‘denotes the dimensionality of embedding. To tackle the two types of edge, we give two kinds of aggregation to model both users and items. For users, we could directly establish the social relation network through user-user edges and then apply attention aggregation on it, shown as Eq.(5): whereâ„âˆˆ Ris latent feature of userğ‘¢,ğœ (Â·)is the non-linear activation function,ğ‘denotes the neighbor set of userğ‘¢,Wâˆˆ Randğ‘âˆˆ Rare weights and bias of the graph network, ğ‘is the attention coeî€œcient of userğ‘¢to userğ‘—. The attention coeî€œcient is obtained by applying a similarity calculation: where||denotes the concatenation operation between two vectors and ğ‘£âˆˆ Ris the weight vector for users. Diî€erent from user links, there is no direct relationship between items. To establish the relation, we leverage meta-path to î€›nd highorder neighbors around the heterogeneous graph[35]. If two items are interacted with the same user, they are more likely to have something in common that satisî€›es userâ€™s interests. Moreover, the items interacted by the same social group are more likely to have relationship. Based on the assumption, we deî€›ne theğ‘˜-order social meta-pathğœ™as{ğ‘–, ğ‘¢, ğ‘¢, ..., ğ‘¢, ğ‘–}, which denotes a combination relation between itemğ‘–andğ‘–,ğ‘˜is the number of users between two items.ğ‘denotes theğ‘˜-order meta-path neighbors of itemğ‘–. In the next, the attention aggregation is applied to the item vertices, shown as follows: whereâ„is theğ‘˜-order representation of itemğ‘–,Wâˆˆ Rand ğ‘âˆˆ Rare weight and bias parameters of the graph network. Similar to Eq. (6), the calculation ofğ‘is shown as Eq. (8), where ğ‘£âˆˆ Ris the weight vector for items. In addition, an order-level normalization is applied to items to obtain the graph-based representation: whereâ„denotes the meta-path based representation of itemğ‘–,ğ‘™is the number of meta-paths,c = {ğ‘, ..., ğ‘}are weight parameters. We replace â„by â„in the rest of the paper for convenience. 3.1.2 Mutually Exciting Temporal Network. To capture temporal features and the î€›ne-grained inî€uence of social relations, STEN imports two neural temporal point processes: a mutually exciting process to model the inî€uence of friendsâ€™ behaviors from each event and a self-exciting process to model userâ€™s dynamic interests. Diî€erent from the RNN-based neural point process model, STEN utilizes the attention mechanism, which could avoid the disappearance of long-distance dependence. Speciî€›cally, STEN divides the mission into two steps: 1) Model the mutual inî€uence of other social-connected users with the target user through mutually exciting temporal network; 2) Extract the user temporal feature from her own sequence through self-exciting temporal network. Firstly, we model the target userğ‘›and friendsâ€™ event sequences as temporal point processes, denote asP(ğœ†(ğ‘¡|ğ»)),{P(ğœ†(ğ‘¡|ğ»))}, whereğ‘€is the maximum number of friends.|P|denotes the length of event sequence for userğ‘—. In each temporal point process, an eventğ‘’means that userğ‘—has an interactive behavior with item at timeğ‘¡. To measure friendsâ€™ inî€uence for each event timestamp in target behavior sequence, STEN models a mutually exciting process for the target user, deî€›ned as: whereğ»is the condition of userğ‘—â€™s behavior history before time ğ‘¡,ğœ†(ğ‘¡, ğ‘¡)represents the mutual inî€uence intensity of friendğ‘—at timeğ‘¡on the target user at timeğ‘¡.ğ›¼is a normalized parameter. For users whose friends exceedğ‘€, we adopt a simple sampling strategy to randomly selectğ‘€friends. Because Eq. (10) explores the impact on the target user, we assume that the friendsâ€™ events are independent of each other. Based on that assumption, the mutually exciting temporal network could treat each event separately. The mutual inî€uence intensity of each friend can be regarded as a sum of the inî€uence of diî€erent events and the mutual inî€uence conditional intensity with two events ğ‘’, ğ‘’follows the form of: whereÎ¦(ğ‘’, ğ‘’)is the cumulative mutual inî€uence intensity function for events ğ‘’, ğ‘’and deî€›ned as follows: Inspired by[23], we propose to model the cumulative mutual inî€uence intensity functionÎ¦(ğ‘’, ğ‘’), rather than the mutual inî€uence intensity. Compared with the latter, our approach has less limitation in î€exible modeling by avoiding costly approximate calculation of integral of mutual inî€uence condition intensity shown in Eq. (10). To take both the content of events and time interval into consideration, the cumulative mutual inî€uence intensity function contains three components: the correlation between two events, the temporal relationship and base intensity, which is deî€›ned as follows: Î¦(ğ‘’, ğ‘’) = F (ğ‘ğ‘œğ‘Ÿğ‘Ÿ (ğ‘’, ğ‘’)+ğ›½ (ğ‘¡âˆ’ğ‘¡)|   {z   }+ ğœ‡|{z} whereF(Â·)is a mapping function:R â†’ Rto guarantee to obtain the positive cumulative mutual inî€uence intensity, and we use softplus here. To consider the inî€uence of friendsâ€™ events, we concatenate friendsâ€™ event embedding together asSâˆˆ R, ğ‘‘= ğ‘€ Ã—ğ‘™ andğ‘™denotes the maximum length of the event sequence. Based on Eq. (11) to (13), we have: ğ´= ğ‘†ğ‘œ ğ‘“ ğ‘¡ğ‘šğ‘ğ‘¥ (ğ‘šğ‘ğ‘ ğ‘˜(QKâˆš+ ğ›½Î”t + ğœ‡ whereQ= â„W,K= SWare query and key matrices trainable parameters of networks.ğ›¼âˆˆ Ais the mutual attention score for friendsâ€™ events.â„âˆˆ s,â„âˆˆ Sare the representations of interactive item of target user and her friends learned from social heterogeneous graph, respectively.Î”tdenotes the time interval between the friendsâ€™ events and the target eventğ‘’. Besides, we apply a mask operation on the temporal attention network to avoid leveraging the â€œfuture informationâ€. In details, for target eventğ‘’, we mask all friendsâ€™ events that happened after time ğ‘¡. After the process of mutually exciting temporal network, STEN has extracted the inî€uence of friends on the target userâ€™s point process, denotes asP(ğœ†(ğ‘¡ |ğ»)) = ğ‘‡= {ğœ†},ğœ†is the social mutual temporal representation of theğ‘–-th event for userğ‘›. However, there still leaves eî€orts on modeling the target userâ€™s event sequence to obtain her temporal representation. 3.1.3 Self-Exciting Temporal Network. The goal of a self-exciting temporal network is to fuse the sequence of temporal representations for interactive items to generate the dynamic representation of users. The main idea of this structure follows the self-exciting process, which is combined with the attention mechanism. For the target processP(ğœ†(ğ‘¡|ğ»)), we apply the attention mechanism to capture the dependency from the sequence without the limitation of length: ğ‘‡= ğ‘†ğ‘œ ğ‘“ ğ‘¡ğ‘šğ‘ğ‘¥ (ğ‘šğ‘ğ‘ ğ‘˜(âˆš+ ğ›½Î”t + ğœ‡))V whereQ= ğ‘‡W, K= ğ‘‡W,V= ğ‘‡Ware query, key and value matrices obtained by linear transformations ofğ‘‡.W, W,Wâˆˆ R,ğ›½, ğœ‡âˆˆ Rare trainable parameters. Similar to the mutually exciting temporal network, we also apply temporal mask operation on the sequence to avoid leveraging â€œfuture informationâ€. From Eq. (16), we obtain the discrete value of condition intensity function over eventsğ‘‡= {ğœ†}. We use the output of the last term as the temporal representation of user â„. 3.1.4 Model Prediction. In addition, to model general social demands, we utilize the target user embeddingâ„learned from social heterogeneous graph as the query and apply a vanilla attention mechanism and average pooling to the target user interacted item sequenceğ¼= {â„, â„, ...â„}, which is also generated by social heterogeneous graph, shown as: whereQ= â„W, K= ğ¼W, V= ğ¼Ware query, key and value matrices transformed byâ„, ğ¼.W, W, Wâˆˆ Rare trainable parameters in transformation. The î€›nal representation of user is obtained by a linear combination of the two parts: temporal behaviors and social inî€uence, shown as follows: where||denotes concatenation operation,Wâˆˆ Ris a transformation matrix andâ„is the î€›nal representation of the user. The prediction of next item is obtained through a softmax function. whereI âˆˆ Ris the embedding matrix of items,ğ‘Œdenotes the probabilities of items will be selected as the next one. In the training stage, we adopt the Bayesian Personalized Ranking (BPR) framework[25] for optimizing the recommendation task: whereğ·, ğ·denote the training set and unobserved item set,Ë†ğ‘¦ is the predicted probability of observed itemğ‘–andË†ğ‘¦is the predicted probability of the sampled unobserved itemğ‘–. To eî€ectively learn from the temporal sequence, we consider the î€›tting of temporal point process by optimizing the maximum log-likelihood of observed items: L= âˆ’ğ‘™ğ‘œğ‘”(ğœ†(ğ‘¡|ğ»)) +ğœ†(ğ‘¡ |ğ»)ğ‘‘ğ‘¡ whereÎ”ğ‘¡is the time interval between observed items. It leverages trapezoidal rule, one of numerical approximations, to calculate the integral in Eq. (21). We î€›nally adopt joint learning for optimizing both the loss of BPR and temporal point process, which is deî€›ned as Eq. (22): whereğ›¾andÎ˜are regularization weights and the set of trainable parameters, respectively. 4.1.1 Datasets. To evaluate the performance of our proposed model and other baselines, we conduct experiments on three real-world datasets. We provide descriptive statistics of them in Table 1. Delicious.This dataset contains social networking and bookmarking information from Delicious online social bookmarking system. It involves the sequence of tagging for each user with timestamps and relationships between users. Yelp.This dataset contains abundant usersâ€™ reviews for local businesses (it is also timestamped) on yelp platform. Here we treat each review as an interactive behavior with a business. Ciao.This dataset involves usersâ€™ rating records and social relations, e.g., trust relations with other users. For data preprocessing, we follow the common previous works[11, 29] to convert all numeric ratings and reviews to implicit feedback with value 1. To avoid too large period, we choose î€›rst 10% data as a division for Yelp dataset to do experiments. To guarantee the quality of datasets, we î€›lter out users that interacted less than 5 times and items appear less than 10 times for Yelp and 5 for the others. For all datasets, we use the last item of each sequence for testing and use the penultimate item for validation. 4.1.2 Evaluation Metrics. We adopt several common evaluation metrics to evaluate the recommendation performance, including Recall, Normalized Discount Cumulative Gain (NDCG) and Mean Reciprocal Rank (MRR): â€¢ Recall@k.It means the percentage of groundtruth relevant items appear within the top-ğ‘˜ranking list. Consider to next-item recommendation, it is equivalent to the hit ratio. â€¢ NDCG@k.It is a standard ranking metric and reî€ects both the correlation and position for each recommended item. For nextitem recommendation, it is formulated as NDCG=, where ğ‘Ÿis the rank of the positive item. â€¢ MRR@k.It takes the actual rank of target item into consideration and is calculated by the mean value of the reciprocal of target itemâ€™s actual rank. When the actual rank is out of k, the reciprocal rank is set to zero. 4.1.3 Baseline Methods. To evaluate the performance of STEN, we choose several comparative baselines, including state-of-the-art methods from both sequential and social recommendation. â€¢ BPR-MF[24]: It utilizes matrix factorization and rating matrix to model latent factors of users and items with the loss of Bayesian pairwise ranking loss. â€¢ FPMC[26]: This method captures usersâ€™ preference from their sequential behaviors based on Markov Chain. â€¢ SRGNN[40]: This method treats userâ€™s sequential behaviors as graph-structural data to capture features from complex transitions of items. â€¢ SASRec[11]: This method adopts an attention mechanism to capture usersâ€™ sequential behaviors and makes prediction based on relatively few actions. â€¢ BERT4Rec[29]: This method employs a deep bidirectional selfattention to model user behavior sequences and achieves strong performance. â€¢ THP[45]: This method is a temporal point process model, which utilizes a transformer to capture the long-term dependency in the temporal sequence. â€¢ TiSASRec[15]:TiSASRec is a time-sensitive method, which models both the absolute positions of items and the time intervals between them together. â€¢ SBPR[43]: This method leverages social connections to enhance the performance of Bayesian Personalized Ranking. â€¢ DANSER[39]: This method collaboratively learns representation of user-speciî€›c attention and context-aware attention in social information by dual graph attention networks. â€¢ Diî€net[38]: Diî€net is a deep inî€uence propagation model that stimulates how users are inî€uenced by the recursive social diî€usion process for social recommendation. 4.1.4 Implementation Details & Parameter Seî€ings. In our experiments, we implement our model with Python 3.7 and Pytorch 1.7.0 and train it and other baselines on 4 Nvidia GTX 2080 GPU with 12G memory. In parameter settings, we use Adam[13] as the optimizer for all models. In addition, we also adopt mini-batch with batchsize of 256. The embedding size and learning rate for all methods are determined by grid search from {40, 60, 80, 100, 120, 140} and {0.001, 0.005, 0.01 }, respectively. The parameters are randomly initialized to î€›t normal distribution N(0,0.01). To avoid overî€›tting and improve robustness, we add the dropout operation with dropout ratio tuning from{0.1,0.2, ...,0.9}and regularization term with coeî€œcient tuning from{0.0001,0.0005,0.001,0.005}. For a fair comparison, the results for all baselines are reported with the optimal hyper-parameter settings. For Diî€net, we remove the fusion component for both user and item to accommodate the absence of features. For THP, we transfer the task of event type prediction to item recommendation and remove the time prediction loss to improve its performance. For our model STEN, the max-order of the graph is set to 2. The sampling number of friends is set to 10 and the maximum sequence length depends on characteristics of datasets, we set {300, 30, 50} for three datasets, respectively. Table 2 shows the performance of our model and baselines over three datasets under the metrics of Recall@k, NDCG@k, MRR@k, k = {10, 20}. According to table 2, we can get the following observation. The conventional recommendation method only takes the rating or interaction into consideration, without both the social relationship and the temporal information, which could explain why BPR-MF achieves poor performance. For general sequential baselines, FPMC performs better than BPR-MF, which indicates the local sequential information is beneî€›cial to sequential recommendation. We believe that the reason SR-GNN performs worst in the general sequential method is that it treats each session individually. SASRec and Bert4Rec both utilize attention mechanisms to capture sequential information. Bert4Rec overcomes SASRec on two datasets, which indicates the advantage of bi-direction networks. In addition, for time-aware sequential methods, e.g., THP utilizes the transformer-based neural Hawkes process to model the asynchronous temporal sequences. However, its performance is worse than other methods. It shows the limitation that it aims to obtain the event representation via the neural Hawkes process. Besides, we think the way to transfer THP into the recommendation task is too direct to be eî€ective. TiSASRec extends SASRec by taking the time interval into consideration and achieves the second-highest results over three datasets, which demonstrates that time interval is an important factor in recommendation. For social-based methods, SBPR is worse than the other two, which indicates GNN is a strong tool to model social relations. DANSER gets great improvement by utilizing the dual attention Table 2: Comparison of STEN and baselines over three datasets. The boldface indicates the highest score and the underline indicates the second highest score. BPR-MF is conventional baseline. FPMC, SRGNN, SASRec and Bert4Rec are general sequential baselines. THP and TiSASRec are time-aware sequential baselines. SBPR, DANSER and Diî€net are social baselines. Table 3: Ablation study on three datasets. (R@10 for Recall@10, N@10 for NDCG@10) Method w/o GE 0.3355 0.2722 0.0468 0.0229 0.0976 0.0582 w/o MT 0.3201 0.2646 0.0431 0.0215 0.0833 0.0490 w/o ST 0.3075 0.2529 0.0447 0.0221 0.0815 0.0482 w/o TC 0.3163 0.2617 0.0463 0.0232 0.0826 0.0484 Default 0.3492 0.2833 0.0512 0.0262 0.1019 0.0596 mechanism to capture the social information for both users and items. Diî€net, which uses the defusion graph structure to stimulate social inî€uence propagation to improve the performance, has a similar performance to the former. Finally, our proposed model STEN achieves the best performance on three datasets and all metrics. The reasons could be summarized as follows: (1) it introduces the temporal point process as the prototype to model both sequential order and time interval; (2) the designed structure mutually exciting attention network achieves the eî€ect of directly modeling the inî€uence of friends sequence on the target user and capture the temporal relationships between behavior events across users; (3) it utilizes a social heterogeneous graph to generate eî€ective social node embedding. To justify the eî€ectiveness of our components, we analyze the impact of utilization of social and temporal information via an ablation study over all datasets. Table 3 shows the performance of STEN and all variants. The variants and the analysis of experiment results are listed as follows: (a) Remove SocialGraphEmbedding Layer. In our model STEN, social information is utilized by two components, the social heterogeneous graph network, and mutually exciting attention network. We replace the structural graph embedding with a trainable embedding lookup operation. The results show that it suî€ers a clear decrease compared to the default model, which denotes the structural view of social relationships is important to describe user and item representations. (b) RemoveMutual-ExcitationTemporal Networks. Here we remove the part of mutually exciting and directly utilize the social graph embedding to calculate the event conditional intensity. The result shows that it suî€ers a signiî€›cant drop. The phenomenon that it performs worse than (a) could demonstrate the superiority of the direct paradigm. Without the mutually exciting temporal networks, the model degrades to a user-level model and suî€ers a lot of information loss. (c) RemoveSelf-ExcitationTemporal Networks. Here we replace the self-exciting module with average pooling. We can observe that it performs the worst among all variants. The result draws to the fact that the impact of the association between userâ€™s own behaviors is more important than the impact of friendâ€™s behaviors. (d) RemoveTemporalComponent. To test the eî€ectiveness of leveraging temporal information, here we remove the temporal component in STEN. Speciî€›cally, we remove the temporal term in Eq. (12) and the temporal loss functionL. The results indicate that removing the temporal component leads to signiî€›cant performance degradation. We believe when temporal information is lost, the model cannot capture the speciî€›c relationship between events. 4.4.1 Performance Comparison w.r.t. the Order of Neighbors. As discussed in Section 3.1.1, we test the impact of a diî€erent order of neighbors in the social heterogeneous graph. Here we choose order kâˆˆ {1,2,3,4}to do experiments and the higher-order social relation graph involves the information of the lower-order neighbors. Figure 3 illustrates the performance under the condition of a diî€erent order of neighbors. We can î€›nd that the performance is improved by the second-order graph. We analyze it for the reason that the secondorder graph provides extra information on social connections and contributes to social sparsity. However, when the order becomes larger, the results change to worse. We consider that it is because the higher-order graph leads to graph convergence and noise, i.e., the diî€erences between users are narrowed. 4.4.2 Performance Comparison w.r.t. the Window Size of Friend Sequence. STEN extracts the event-level social inî€uence through the mutually exciting temporal network. The larger window size brings richer social information and more complicated calculations. Hence, we explore the impact of the window size of friend behavior event sequence. As Figure 4 illustrates, with the increasing of the window size, the performance is î€›rst improved and then converges. When the window size is too short, the model only captures the current state of the friend, which contains a large deviation. The selection of window size depends on the average length of the userâ€™s event sequence. 4.4.3 Performance Comparison w.r.t. the Number of Sampled Friends. To reduce the computation for users with complex relationships, STEN adopts a random sampling operation for their friends in mutually exciting temporal network. Figure 5 illustrates how the modelâ€™s performance varies with the number of sampled friends. The results show that the performance of the model improves î€›rst and then converges with the increase of the number of samples. When only one friend is sampled, the performance of the model decreases signiî€›cantly. Compared with the rest, the result on Delicious shows it is insensitive to the number of sampled friends. We consider the reasons can be summed up into two points: 1) As Table 1 shows, the average relations is obviously less than the rest. 2) It has a smaller proportion of Time-Eî€œcient Friends (TEF). The deî€›nition of TEF is that the sequence of behavior events has an intersection with the target user in time. The proportions of TEF over three datasets are shown in Table 4. In this part, we conduct a case study on the Delicious dataset to show the explainability of our model. We visualize the attention weights Figure 4: The impact of the window size of friend sequences. Figure 5: The impact of the number of sampled friends. Figure 6: Visualization of attention weights in STEN. ğ»denotes the impact of friends to target user. ğ»denotes the impact of friends events on target user event. ğ», ğ»denote the impact of target user behavior events on themselves, where ğ»involves the temporal information, but ğ»does not. of diî€erent modules in Figure 6. The value inğ», which is obtained from the graph network component, indicates the impact of friends on to target user. It shows the coarse-grained relationships at the user level, whileğ», ğ», ğ»describe the î€›ne-grained relationships at the event level.ğ»is obtained from mutually exciting temporal network, which indicates the impact of a friendâ€™s events on event #146. The value 0 inğ»means that the event happens after event #146, which obeys the rule that no future information is leveraged. ğ», ğ»indicate the impact of target user behavior events on themselves. The diî€erence is thatğ»involves temporal information and event-level social relation, whileğ»only has user-level social information. Besides, we use these two parts to make recommendations separately and show the predicted position of the ground truth event. It is clear that the two parts have diî€erent focuses on the event sequence and aî€ect the performance of the model. We evaluate the temporal and space complexity of STEN by recording the inference time and the model parameters. We compare STEN with the best-performing baselines from three categories mentioned in section 4.2 and results are reported in Table 5. As online recommendation services usually have high requirements on latency, the computational cost during inference is more important than that of the training stage. Compared with the baselines, the increased inference time of STEN is 11% on average, which denotes the eî€œciency of our model. Besides, we use the number of model parameters to measure the space complexity of models. Despite STEN has performed î€›ne-grained modeling at the event level, it gets the 10% increase on average, within an acceptable range. Compared with the embeddings of both users and items, the parameters in heterogeneous graph component and temporal excitation networks only occupy a small proportion. Table 5: Comparsion of model complexity on Ciao dataset. MethodInferenceTimeINCR. Parameters INCR. In this section, we brieî€y review the related research work from three aspects: social recommendation, general sequential recommendation, and time-aware sequential recommendation. Social Recommendation.Leveraging social information has played an essential role in alleviating the problem of data sparsity and enhancing recommendation. Kautz et al. [12] import social networks into traditional method collaborative î€›ltering for item recommendation. Ma et al. [17] propose SoRec that incorporates trust network into user tastes analysis through probabilistic matrix factorization. In addition, factor-based random walk is combined with a coupled latent factor model in[41] to deal with both social connections and interest interactions. Besides, Zhao et al. [43] extend the framework of social networks with collaborative î€›ltering to the one-class recommendation. With the development of neural networks, some research works[5,36] utilize deep neural networks to extract information of social networks and learn the complex latent representation. ARSE[30] combines attention mechanism with social LSTM to leverage the temporal information to enhance social recommendation. GraphRec[7] utilizes GNNs to model user-user and user-item graphs and heterogeneous strengths in social recommendation. To better simulate the recursive diî€usion in social networks, Diî€net[38] is designed with an inî€uence propagation structure to model usersâ€™ latent embedding. To learn latent features from both neighbors and related items, a dual graph attention network model named DANSER[39] is proposed and it solves the problem of diversity of neighborâ€™s inî€uence. DGRec[28] utilizes RNNs to model usersâ€™ dynamic interests and generates the user representation î€›rstly and then combines it with their social relationship through GNNs. General Sequential Recommendation.Sequential recommendation has attracted a lot of attention from both academia and industry. The key of sequential recommendation is to extract the hidden information from the user behavior sequence. Rendle et al. [26] propose FPMC, which imports Markov Chain (MC) to matrix factorization for user state transition. In addition, RNN and its variants, e.g., Long Short-Term Memory (LSTM) [10] and Gated Recurrent Unit (GRU) [3] are used to model the sequential behaviors of user for their latent features in many related studies[9,37,42]. However, RNN-based models usually suî€er from low computational eî€œciency. CNN-based model Caser[32] is proposed to use a bi-direction convolution î€›lter to learn sequential patterns. To improve the ability of modeling long sequence, attention-based method Transformer[33] and BERT[4] are utilized by SASRec[11]and BERT4Rec [29] to capture sequential information, respectively. Wu et al. propose SRGNN[40] that utilizes Gated graph neural network[16] to capture structure information from sequential data. Time-aware Sequential Recommendation.To take the time interval of user actions into consideration, there also develops many time-sensitive recommendation methods. Time-LSTM[44] captures the userâ€™s long short-term dynamic interests through the speciî€›c time gates. Based on SASRec[11], TiSASRec[15] take the time interval between diî€erent actions into consideration and model different time intervals as relations between any two interactions. Besides, another way for the time-sensitive method is to formulate the sequence as a temporal point process. LSHP[2] models the long-term and short-term dependency between usersâ€™ online interactive behaviors through a Hawkes Process. With the development of neural point process, e.g., neural Hawkes Process[21], CTRec[1] utilizes a convolutional LSTM and attention mechanism to capture short-term and long-term interests, respectively, based on a demand-aware Hawkes Process. However, RNN-based point process models have limitations in both capturing long-term dependency and computational eî€œciency. Hawkes process is combined with self-attention mechanism in[45] to alleviate the limitations. The above time-aware studies leverage the temporal information to model the behavior sequence of individual users. By contrast, our model STEN aims to leverage the temporal information not only to model the userâ€™s dynamic interests but also to capture the relation among users through their temporal mutual dependency. In this paper, we propose a novel time-aware sequential recommendation model STEN, to model the î€›ne-grained temporal behavior sequences of users with social information. STEN establishes a social heterogeneous graph to learn the node representations of users and items. In order to model the time-aware behavior sequence, we introduce two classical temporal point processes as prototypes to enhance STEN. STEN models the impact of friends behavior sequences and userâ€™s behavior sequence in a direct paradigm by mutually exciting temporal network and self-exciting temporal network. Compared with the previous methods, STEN could model the temporal relationships between cross-user events. As a future plan, we will improve the current model to be type-aware to better model the inî€uence of diî€erent types of events and to expand its applicable scenario.